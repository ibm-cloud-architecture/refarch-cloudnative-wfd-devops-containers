
---
name: "What is for dinner Toolchain"
description: "Microservices sample application"
version: 0.1
required:
 - deploy

git-wfd-eureka:
  service_id: githubpublic
  parameters:
    repo_name: "eureka-toolchain-test"
    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-netflix-eureka"
    type: clone
    has_issues: false

#git-wfd-zuul:
#  service_id: githubpublic
#  parameters:
#    repo_name: "refarch-cloudnative-netflix-zuul-{{name}}"
#    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-netflix-zuul"
#    type: clone
#    has_issues: false
#
#git-wfd-config-server:
#  service_id: githubpublic
#  parameters:
#    repo_name: "refarch-cloudnative-spring-config-{{name}}"
#    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-spring-config"
#    type: clone
#    has_issues: false
#
#git-wfd-menu-ui:
#  service_id: githubpublic
#  parameters:
#    repo_name: "refarch-cloudnative-wfd-ui-{{name}}"
#    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-netflix-zuul"
#    type: clone
#    has_issues: false
#
#git-wfd-menu:
#  service_id: githubpublic
#  parameters:
#    repo_name: "refarch-cloudnative-netflix-zuul-{{name}}"
#    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-wfd-ui"
#    type: clone
#    has_issues: false
#
#git-wfd-appetizer:
#  service_id: githubpublic
#  parameters:
#    repo_name: "refarch-cloudnative-wfd-appetizer-{{name}}"
#    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-wfd-appetizer"
#    type: clone
#    has_issues: false
#
#git-wfd-entree:
#  service_id: githubpublic
#  parameters:
#    repo_name: "refarch-cloudnative-wfd-entree-{{name}}"
#    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-wfd-entree"
#    type: clone
#    has_issues: false
#
#git-wfd-dessert:
#  service_id: githubpublic
#  parameters:
#    repo_name: "refarch-cloudnative-wfd-dessert-{{name}}"
#    repo_url: "https://github.com/ibm-cloud-architecture/refarch-cloudnative-wfd-dessert"
#    type: clone
#    has_issues: false


pipeline-wfd-eureka:
  service_id: pipeline
  hidden: [form, description]
  parameters:
    name: "wfd-eureka"
    ui-pipeline: true
    services: ["git-wfd-eureka"]
    configuration:
      content: $file(wfd_eureka_pipeline.yml)
      env:
       # Build java stage env variables
       DOCKER_DIR: "docker"
       BUILD_TARGET: "build/libs/eureka-0.0.1-SNAPSHOT.jar"
       REPO: "{{git-wfd-eureka.parameters.repo_url}}"
       # Build container stage env variables
       REGION: "{{deploy.parameters.deploy-region}}"
       ORG: "{{deploy.parameters.deploy-org}}"
       SPACE: "{{deploy.parameters.deploy-space}}"
       NAME: "{{pipeline-wfd-eureka.parameters.name}}"
       LABEL_PREFIX: "toolchain"
       # Deploy stage env variables
       PORT: "8761"
       MIN_INSTANCES: "1"
       MAX_INSTANCES: "2"
       DESIRED_INSTANCES: "1"
       CONCURRENT_VERSIONS: "1"
       AUTO_RECOVERY: false
       CONTAINER_SIZE: "micro"
       IGNORE_MAPPING_ROUTE: "true"
       SERVICE_DISCOVERY_UPS: "eureka-service-discovery"
       BRIDGE_APP: "container_brige_app"
      execute: false


deploy:
  schema: deployment_schema.json
  service-category: pipeline
  parameters:
    deploy-region: "{{region}}"
    deploy-org: "{{organization}}"
    deploy-space: "{{space}}"
    route-domain: "mybluemix.net"
    context-path: "micro"
